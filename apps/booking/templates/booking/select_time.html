{% extends "base.html" %}
{% block title %}Select Time{% endblock %}
{% block content %}
<main>
    <section class="container container-background make-appointment-section mt-4">
        <h2 class="text-center my-4">Available Times for - {{ selected_date }}</h2>

        <form method="post" action="{% url 'book_appointment' %}">
            {% csrf_token %}

            <!-- Seção para escolher horário -->
            <div class="mb-3">
                <label for="time" class="form-label">Choose a time:</label>
                <select name="time" class="form-select" required>
                    {% if available_times %}
                        {% for time in available_times %}
                            <option value="{{ time }}">{{ time }}</option>
                        {% endfor %}
                    {% else %}
                        <option value="">No available times</option>
                    {% endif %}
                </select>
            </div>

            <!-- Inputs ocultos para data e stylist -->
            <input type="hidden" name="selected_date" value="{{ selected_date }}">
            <input type="hidden" name="selected_stylist_id" value="{{ selected_stylist_id }}">

            <!-- Seção para escolher serviço -->
            <div class="mb-3">
                <h4 class="mb-3">Select a Service</h4>
                <select name="service" class="form-select" required>
                    {% for service in services %}
                        <option value="{{ service.id }}">{{ service.title }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Campo para cupom -->
            <div class="mb-3">
                <label for="coupon" class="form-label">Optional Coupon Code:</label>
                <input type="text" name="coupon" class="form-control" placeholder="Enter coupon code">
            </div>

            <!-- Botão de envio -->
            <div class="text-center">
                <button type="submit" class="mb-3 btn btn-primary">Book</button>
            </div>
        </form>
    </section>
</main>

<!-- Modal for invalid coupon -->
<div class="modal fade" id="invalidCouponModal" tabindex="-1" aria-labelledby="invalidCouponModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="invalidCouponModalLabel">Invalid Coupon</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                The coupon code you entered is invalid or has expired. Please try again or contact support.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="document.getElementById('coupon').focus();">Try Again</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal for invalid coupon -->
<div class="modal fade" id="invalidCouponModal" tabindex="-1" aria-labelledby="invalidCouponModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="invalidCouponModalLabel">Invalid Coupon</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                The coupon code you entered is invalid or has expired. Please try again or contact support.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="document.getElementById('coupon').focus();">Try Again</button>
            </div>
        </div>
    </div>
</div>

<!-- Script para mostrar o modal -->
{% if show_invalid_coupon_modal %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var invalidCouponModal = new bootstrap.Modal(document.getElementById('invalidCouponModal'));
        invalidCouponModal.show();
    });
</script>
{% endif %}
{% endblock %}